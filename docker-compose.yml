version: '3.8'

services:
  # Backend service
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      - NODE_ENV=development
      - LIVEKIT_URL=${LIVEKIT_URL}
      - LIVEKIT_API_KEY=${LIVEKIT_API_KEY}
      - LIVEKIT_API_SECRET=${LIVEKIT_API_SECRET}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    volumes:
      - ./backend:/app
      - /app/node_modules
    depends_on:
      - livekit
    networks:
      - livekit-network

  # Frontend service
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "3800:80"
    environment:
      - REACT_APP_BACKEND_URL=${REACT_APP_BACKEND_URL}
      - REACT_APP_LIVEKIT_URL=${REACT_APP_LIVEKIT_URL}
    volumes:
      - ./frontend:/app
      - /app/node_modules
    depends_on:
      - backend
    networks:
      - livekit-network

  # LiveKit server for local development
  livekit:
    image: livekit/livekit-server
    command: --dev --bind 0.0.0.0 --port 7880 --udp-port 7881 --udp-port 7882
    ports:
      - "7880:7880"
      - "7881:7881/udp"
      - "7882:7882/udp"
    environment:
      LIVEKIT_KEYS: "${LIVEKIT_API_KEY}: ${LIVEKIT_API_SECRET}"
      OPENAI_API_KEY: ${OPENAI_API_KEY}
    networks:
      - livekit-network

networks:
  livekit-network:
    driver: bridge
